
/*!
 * angular-pickr - Angular directive for pickr
 * v0.1.1
 * https://github.com/firstandthird/angular-pickr
 * copyright First + Third 2013
 * MIT License
*/
!function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.delegateEvents(),this.dataElements(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d,f):this[e]&&"function"!=typeof this[e]?this[e].on(d,f):this.el.on(d,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click","[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+".fidel"+this.id,b)},d.prototype.one=function(a,b){this.el.one(a+".fidel"+this.id,b)},d.prototype.emit=function(a,b,c){var d=c?".fidel"+this.id:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(".fidel"+this.id)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){var b=a.template,c={};opts={openTag:"<%",closeTag:"%>"};var d=function e(a,b){var d=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split(opts.openTag).join("	").replace(new RegExp("((^|"+opts.closeTag+")[^	]*)'","g"),"$1\r").replace(new RegExp("	=(.*?)"+opts.closeTag,"g"),"',$1,'").split("	").join("');").split(opts.closeTag).join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):c[a]=c[a]||e(a);return b?d(b):d};d.options=opts,d.noConflict=function(){return a.template=b,d},a.template=d}(window),function(a){a.template=template.noConflict(),a.prototype.render=function(b,c){var d=this.template?this.template:$("#"+this.templateId).html();c=c||this.el,c.html(a.template(d,b))}}(window.Fidel),function(a){var b=a.TimeFormat,c="January|February|March|April|May|June|July|August|September|October|November|December".split("|"),d="Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday".split("|"),e=function(a,b){return!b instanceof Date?void 0:a.replace(/%d|%D|%j|%l|%S|%w|%F|%m|%M|%n|%Y|%y|%a|%A|%g|%G|%h|%H|%i|%s|%u|%e/g,function(a){switch(a){case"%d":return("0"+b.getDate()).slice(-2);case"%D":return d[b.getDay()].substr(0,3);case"%j":return b.getDate();case"%l":return d[b.getDay()];case"%S":return 1===b.getDate()?"st":2===b.getDate()?"nd":3===b.getDate()?"rd":"th";case"%w":return b.getDay();case"%F":return c[b.getMonth()];case"%m":return("0"+(b.getMonth()+1)).slice(-2);case"%M":return c[b.getMonth()].substr(0,3);case"%n":return b.getMonth();case"%Y":return b.getFullYear();case"%y":return b.getFullYear().toString().slice(-2);case"%a":return b.getHours()>11?"pm":"am";case"%A":return b.getHours()>11?"PM":"AM";case"%g":return b.getHours()>12?b.getHours()-12:b.getHours()?b.getHours():12;case"%G":return b.getHours();case"%h":return("0"+(b.getHours()>12?b.getHours()-12:b.getHours())).slice(-2);case"%H":return("0"+b.getHours()).slice(-2);case"%i":return("0"+b.getMinutes()).slice(-2);case"%s":return("0"+b.getSeconds()).slice(-2);case"%u":return b.getMilliseconds();case"%e":return b.getTimezoneOffset()}})};e.noConflict=function(){return a.TimeFormat=b,e},a.TimeFormat=e}(window),function(a){a.declare("pickr",{defaults:{hideDelay:150,displayMonths:1,template:'<div class="pickr-months">  <button type="button" class="pickr-prev-month">&lsaquo;</button>  <button type="button" class="pickr-next-month">&rsaquo;</button>  <% for (var i = 0; i < months.length; i++) { var month = months[i]; %>    <div class="pickr-month" data-pickr-date="<%= month.date %>">      <div class="pickr-month-title">        <%= timef(\'%F\', month.date) %>        <% if(today.getFullYear() !== month.date.getFullYear()) { %>          &nbsp; <span><%= timef(\'(%Y)\', month.date) %></span>        <% } %>      </div>      <div class="pickr-days">        <div class="pickr-days-labels">          <% for(var l = 0; l < dayLabels.length; l++) { %>          <div class="pickr-days-label"><%= dayLabels[l] %></div>          <% } %>        </div>                <% if(month.start > 0) { %>        <div class="pickr-day-buffer">          <% for(var d = 1; d < month.start+1; d++) { %>          <div class="pickr-empty-day">&nbsp;</div>          <% } %>        </div>        <% } %>        <% for(var d = 1; d < month.days+1; d++) { %>        <% var isToday = (today.getMonth() === month.date.getMonth() && today.getDate() === d); %>        <% var isPastDay = (!allowPastDays && ~~timef(\'%Y%m%d\', new Date(month.date.getFullYear(), month.date.getMonth(), d)) < ~~timef(\'%Y%m%d\', today)); %>        <div class="pickr-day <%= isToday ? \'pickr-today\' : \'\' %> <%= isPastDay ? \'pickr-past\' : \'\' %>"><%= d %></div>        <% } %>        <% if(month.end > 0) { %>        <div class="pickr-day-buffer">          <% for(var d = 1; d < month.end+1; d++) { %>          <div class="pickr-empty-day">&nbsp;</div>          <% } %>        </div>        <% } %>      </div>    </div>  <% } %></div>',currentMonth:new Date,dayLabels:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"%Y-%m-%d",allowPastDays:!0},init:function(){this.el.addClass("pickr"),this.pickrContainer=a("<div></div>").addClass("pickr-container"),this.el.after(this.pickrContainer),this.focus=!1,this.el.data("pickr-format")&&(this.dateFormat=this.el.data("pickr-format")),this.bindEvents()},bindEvents:function(){this.el.on("focus",this.proxy(this.showModal)),this.el.on("blur",this.proxy(this.hideModal)),this.pickrContainer.on("click",this.proxy(this.containerClicked)),this.pickrContainer.on("click","*",this.proxy(this.containerClicked))},update:function(){var a,b,c=[];for(a=0;a<this.displayMonths;a++)b=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+a,1),c.push({date:b,days:this.daysInMonth(b),start:this.monthStartIndex(b),end:this.monthEndIndex(b)});var d={timef:TimeFormat,months:c,dayLabels:this.dayLabels,today:new Date,allowPastDays:this.allowPastDays};this.render(d,this.pickrContainer)},showModal:function(){if(!this.focus){this.focus=!0;var a=this.el.offset();this.pickrContainer.css({left:a.left,top:a.top+this.el.outerHeight()}),this.update()}},hideModal:function(a){a.preventDefault(),this.hideTimer=setTimeout(this.proxy(function(){this.pickrContainer.empty(),this.focus=!1}),this.hideDelay)},containerClicked:function(b){b.stopPropagation(),b.preventDefault(),clearTimeout(this.hideTimer),this.focus=!0,this.el.focus();var c=a(b.target);if(c.is(".pickr-day")&&!c.is(".pickr-past")){var d=c.text(),e=new Date(c.parents(".pickr-month").data("pickr-date"));e.setDate(d),this.selectDate(e)}c.is(".pickr-prev-month")&&this.prevMonth(),c.is(".pickr-next-month")&&this.nextMonth(),c.is(".pickr-month-title")&&this.today()},selectDate:function(a){this.el.val(TimeFormat(this.dateFormat,a)),this.el.trigger("input"),this.el.blur()},daysInMonth:function(a){var b=new Date(a.getFullYear(),a.getMonth()+1,0);return b.getDate()},monthStartIndex:function(a){var b=new Date(a.getFullYear(),a.getMonth(),1);return b.getDay()},monthEndIndex:function(a){var b=new Date(a.getFullYear(),a.getMonth(),this.daysInMonth(a));return 6-b.getDay()},prevMonth:function(){this.currentMonth.setMonth(this.currentMonth.getMonth()-this.displayMonths),this.update()},nextMonth:function(){this.currentMonth.setMonth(this.currentMonth.getMonth()+this.displayMonths),this.update()},today:function(){this.currentMonth=new Date,this.update()}})}(jQuery),function(){angular.module("pickr",[]).directive("pickr",["$parse",function(){return{restrict:"EA",require:"ngModel",scope:{model:"=ngModel",options:"&pickr"},link:function(a,b){var c=a.options();b.pickr(c),b.on("input",function(){a.$apply(function(){a.model=b.val()})}),a.$watch("model",function(a){void 0!==a&&b.val(a)})}}}])}();